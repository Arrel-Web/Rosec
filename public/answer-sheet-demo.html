<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Answer Sheet & Key Maker - Demo</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    
    body { 
      background: linear-gradient(180deg,#fafafa,#f1f3f4); 
      color: #202124; 
      min-height: 100vh; 
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #e0e0e0;
    }
    
    .nav-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .nav-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: #6c757d;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-weight: 600;
      transition: background-color 0.2s ease;
    }
    
    .nav-btn:hover {
      background: #5a6268;
      color: white;
    }
    
    .config-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .config-card {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }
    
    .config-card h3 {
      margin-bottom: 15px;
      color: #333;
    }
    
    .form-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 15px;
    }
    
    .form-row label {
      font-weight: 600;
      color: #333;
    }
    
    .input {
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.2s ease;
    }
    
    .input:focus {
      outline: none;
      border-color: #1a73e8;
      box-shadow: 0 0 0 2px rgba(26,115,232,0.1);
    }
    
    .required-field {
      color: #dc3545;
      font-weight: bold;
    }
    
    .btn-group {
      display: flex;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
    }
    
    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .btn-primary { background: #1a73e8; color: white; }
    .btn-success { background: #28a745; color: white; }
    .btn-secondary { background: #6c757d; color: white; }
    .btn-warning { background: #ffc107; color: #000; }
    
    .answer-sheet-preview {
      border: 2px solid #000;
      padding: 20px;
      background: white;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin: 20px 0;
      display: none;
    }
    
    .scanner-marker {
      width: 20px;
      height: 20px;
      background: #000;
      display: inline-block;
      margin: 0 5px;
    }
    
    .sheet-header {
      text-align: center;
      border-bottom: 2px solid #000;
      padding-bottom: 15px;
      margin-bottom: 20px;
    }
    
    .student-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #000;
    }
    
    .id-sections {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin: 20px 0;
      padding: 15px 0;
      border-top: 1px solid #000;
      border-bottom: 1px solid #000;
    }
    
    .id-section {
      text-align: center;
    }
    
    .id-section h4 {
      margin-bottom: 10px;
      font-weight: bold;
    }
    
    .id-bubbles {
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .digit-column {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    
    .digit-label {
      font-size: 10px;
      font-weight: bold;
      margin-bottom: 2px;
    }
    
    .id-bubble {
      width: 14px;
      height: 14px;
      border: 1px solid #000;
      border-radius: 50%;
      display: block;
      margin: 1px auto;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    
    .id-bubble.filled {
      background: #000;
    }
    
    .questions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .question-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    
    .question-number {
      min-width: 30px;
      font-weight: bold;
    }
    
    .choice-bubble {
      width: 16px;
      height: 16px;
      border: 2px solid #000;
      border-radius: 50%;
      display: inline-block;
      margin: 0 3px;
    }
    
    .choice-bubble.filled {
      background: #000;
    }
    
    .points-display {
      font-size: 10px;
      color: #666;
      margin-left: 5px;
    }
    
    .answer-key-section {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid #000;
      display: none;
    }
    
    .key-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .key-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 8px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #f9f9f9;
    }
    
    .key-question-number {
      font-weight: bold;
      margin-bottom: 8px;
      color: #333;
    }
    
    .key-choices {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    
    .key-bubble {
      width: 20px;
      height: 20px;
      border: 2px solid #000;
      border-radius: 50%;
      display: inline-block;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }
    
    .key-bubble:hover {
      background: #e0e0e0;
      transform: scale(1.1);
    }
    
    .key-bubble.selected {
      background: #000;
    }
    
    .key-bubble::after {
      content: attr(data-choice);
      position: absolute;
      bottom: -18px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      font-weight: bold;
    }
    
    @media (max-width: 768px) {
      .config-section {
        grid-template-columns: 1fr;
      }
      
      .id-sections {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .student-info {
        grid-template-columns: 1fr;
      }
      
      .btn-group {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1><i class="fa-solid fa-file-lines"></i> Answer Sheet & Key Maker</h1>
      <p>Create answer sheets and keys with scanner compatibility - Demo Version</p>
    </div>

    <!-- Navigation Buttons -->
    <div class="nav-buttons">
      <a href="dashboard.html" class="nav-btn">
        <i class="fa-solid fa-home"></i>
        Home
      </a>
      <a href="javascript:history.back()" class="nav-btn">
        <i class="fa-solid fa-arrow-left"></i>
        Back
      </a>
    </div>

    <!-- Configuration Section -->
    <div class="config-section">
      <div class="config-card">
        <h3>Basic Settings</h3>
        <div class="form-row">
          <label for="examTitle">Exam Title:</label>
          <input type="text" id="examTitle" class="input" value="Midterm Examination" placeholder="Enter exam title">
        </div>
        <div class="form-row">
          <label for="subjectName">Subject:</label>
          <input type="text" id="subjectName" class="input" value="Mathematics 101" placeholder="Enter subject name">
        </div>
        <div class="form-row">
          <label for="className">Class:</label>
          <input type="text" id="className" class="input" value="BSIT-3A" placeholder="Enter class name">
        </div>
      </div>

      <div class="config-card">
        <h3>ID Configuration</h3>
        <div class="form-row">
          <label for="studentIdLength">Student ID Length <span class="required-field">*</span>:</label>
          <input type="number" id="studentIdLength" class="input" min="1" max="15" value="8" placeholder="1-15 digits">
          <small>Required field: Number of digits for student ID bubbles</small>
        </div>
        <div class="form-row">
          <label for="subjectIdLength">Subject ID Length (Optional):</label>
          <input type="number" id="subjectIdLength" class="input" min="0" max="8" value="4" placeholder="0-8 digits">
          <small>Leave as 0 to disable subject ID section</small>
        </div>
      </div>

      <div class="config-card">
        <h3>Question Settings</h3>
        <div class="form-row">
          <label for="totalQuestions">Total Questions:</label>
          <input type="number" id="totalQuestions" class="input" min="1" max="100" value="25">
        </div>
        <div class="form-row">
          <label for="choiceOptions">Choice Options:</label>
          <select id="choiceOptions" class="input">
            <option value="3">A, B, C</option>
            <option value="4" selected>A, B, C, D</option>
            <option value="5">A, B, C, D, E</option>
          </select>
        </div>
        <div class="form-row">
          <label for="questionsPerColumn">Questions per Column:</label>
          <input type="number" id="questionsPerColumn" class="input" min="5" max="50" value="15">
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="btn-group">
      <button id="generateSheet" class="btn btn-primary">
        <i class="fa-solid fa-file-lines"></i>
        Generate Answer Sheet
      </button>
      <button id="saveTemplate" class="btn btn-success">
        <i class="fa-solid fa-save"></i>
        Save Template
      </button>
      <button id="printSheet" class="btn btn-secondary">
        <i class="fa-solid fa-print"></i>
        Print Sheet
      </button>
    </div>

    <!-- Answer Sheet Preview -->
    <div id="sheetPreview" class="answer-sheet-preview">
      <!-- Generated sheet will appear here -->
    </div>

    <!-- Answer Key Section -->
    <div id="answerKeySection" class="answer-key-section">
      <h3><i class="fa-solid fa-key"></i> Answer Key Configuration</h3>
      <p>Click the bubbles to fill in the correct answers for each question:</p>
      <div id="answerKeyGrid" class="key-grid">
        <!-- Answer key inputs will be generated here -->
      </div>
      <div class="btn-group">
        <button id="saveAnswerKey" class="btn btn-success">
          <i class="fa-solid fa-save"></i>
          Save Answer Key
        </button>
        <button id="clearAnswerKey" class="btn btn-secondary">
          <i class="fa-solid fa-eraser"></i>
          Clear All
        </button>
      </div>
    </div>
  </div>

  <script>
    // Current answer key data
    let currentAnswerKey = {};

    // Generate answer sheet
    document.getElementById('generateSheet').addEventListener('click', generateAnswerSheet);

    function generateAnswerSheet() {
      const examTitle = document.getElementById('examTitle').value || 'Examination';
      const subjectName = document.getElementById('subjectName').value || '';
      const className = document.getElementById('className').value || '';
      const totalQuestions = parseInt(document.getElementById('totalQuestions').value) || 25;
      const choiceCount = parseInt(document.getElementById('choiceOptions').value) || 4;
      const questionsPerColumn = parseInt(document.getElementById('questionsPerColumn').value) || 15;
      const studentIdLength = parseInt(document.getElementById('studentIdLength').value) || 8;
      const subjectIdLength = parseInt(document.getElementById('subjectIdLength').value) || 0;
      
      // Validate student ID length (mandatory)
      if (studentIdLength < 1 || studentIdLength > 15) {
        alert('Student ID length must be between 1 and 15 digits.');
        return;
      }
      
      // Generate choice letters
      const choices = [];
      for (let i = 0; i < choiceCount; i++) {
        choices.push(String.fromCharCode(65 + i)); // A, B, C, D, E
      }
      
      // Generate scanner start/end markers
      const scannerStartMarker = '<div class="scanner-marker"></div>'.repeat(5);
      const scannerEndMarker = '<div class="scanner-marker"></div>'.repeat(5);
      
      // Generate answer sheet HTML
      let sheetHTML = `
        <div class="sheet-header">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            ${scannerStartMarker}
            <div style="text-align: center; flex: 1;">
              <h2 style="margin: 0; font-size: 18px;">${examTitle}</h2>
              <p style="margin: 5px 0; font-size: 14px;">${subjectName}</p>
              ${className ? `<p style="margin: 5px 0; font-size: 12px;">Class: ${className}</p>` : ''}
            </div>
            ${scannerStartMarker}
          </div>
        </div>
        
        <div class="student-info">
          <div>
            <strong>Name:</strong> ________________________________<br><br>
            <strong>Date:</strong> ________________________________
          </div>
          <div>
            <strong>Section:</strong> ________________________________<br><br>
            <strong>Signature:</strong> ________________________________
          </div>
        </div>
      `;
      
      // Add ID sections
      sheetHTML += generateIdSections(studentIdLength, subjectIdLength);
      
      // Generate questions section
      sheetHTML += `<div class="questions-grid">`;
      
      // Generate questions in columns
      const columns = Math.ceil(totalQuestions / questionsPerColumn);
      for (let col = 0; col < columns; col++) {
        sheetHTML += '<div class="question-column">';
        
        const startQuestion = col * questionsPerColumn + 1;
        const endQuestion = Math.min(startQuestion + questionsPerColumn - 1, totalQuestions);
        
        for (let q = startQuestion; q <= endQuestion; q++) {
          sheetHTML += `
            <div class="question-row">
              <span class="question-number">${q}.</span>
              ${choices.map(choice => `
                <span class="choice-bubble" data-question="${q}" data-choice="${choice}"></span>
                <span>${choice}</span>
              `).join('')}
              <span class="points-display">(1 pt)</span>
            </div>
          `;
        }
        
        sheetHTML += '</div>';
      }
      
      sheetHTML += `
        </div>
        <div style="margin-top: 30px; text-align: center; display: flex; justify-content: space-between; align-items: center;">
          ${scannerEndMarker}
          <div style="flex: 1; text-align: center;">
            <strong>END OF ANSWER SHEET</strong><br>
            <small>Total Questions: ${totalQuestions} | Total Points: ${totalQuestions}</small>
          </div>
          ${scannerEndMarker}
        </div>
      `;
      
      document.getElementById('sheetPreview').innerHTML = sheetHTML;
      document.getElementById('sheetPreview').style.display = 'block';
      
      // Generate answer key inputs with bubbles
      generateAnswerKeyBubbles(totalQuestions, choices);
      
      // Scroll to preview
      document.getElementById('sheetPreview').scrollIntoView({ behavior: 'smooth' });
    }

    function generateIdSections(studentIdLength, subjectIdLength) {
      let idHTML = '<div class="id-sections">';
      
      // Student ID section (mandatory)
      idHTML += `
        <div class="id-section">
          <h4>STUDENT ID (Required)</h4>
          <div class="id-bubbles">
            ${Array.from({length: studentIdLength}, (_, digitIndex) => `
              <div class="digit-column">
                <div class="digit-label">${digitIndex + 1}</div>
                ${Array.from({length: 10}, (_, digit) => `
                  <div class="id-bubble" data-type="student" data-digit="${digitIndex}" data-value="${digit}">${digit}</div>
                `).join('')}
              </div>
            `).join('')}
          </div>
        </div>
      `;
      
      // Subject ID section (optional)
      if (subjectIdLength > 0) {
        idHTML += `
          <div class="id-section">
            <h4>SUBJECT ID (Optional)</h4>
            <div class="id-bubbles">
              ${Array.from({length: subjectIdLength}, (_, digitIndex) => `
                <div class="digit-column">
                  <div class="digit-label">${digitIndex + 1}</div>
                  ${Array.from({length: 10}, (_, digit) => `
                    <div class="id-bubble" data-type="subject" data-digit="${digitIndex}" data-value="${digit}">${digit}</div>
                  `).join('')}
                </div>
              `).join('')}
            </div>
          </div>
        `;
      } else {
        // Add empty section to maintain grid layout
        idHTML += '<div class="id-section" style="opacity: 0.3;"><h4>Subject ID Disabled</h4><p style="font-size: 12px;">Set length > 0 to enable</p></div>';
      }
      
      idHTML += '</div>';
      return idHTML;
    }

    function generateAnswerKeyBubbles(totalQuestions, choices) {
      const answerKeyGrid = document.getElementById('answerKeyGrid');
      answerKeyGrid.innerHTML = '';
      
      for (let i = 1; i <= totalQuestions; i++) {
        const keyItem = document.createElement('div');
        keyItem.className = 'key-item';
        
        const questionNumber = document.createElement('div');
        questionNumber.className = 'key-question-number';
        questionNumber.textContent = `Q${i}`;
        
        const choicesContainer = document.createElement('div');
        choicesContainer.className = 'key-choices';
        
        choices.forEach(choice => {
          const bubble = document.createElement('div');
          bubble.className = 'key-bubble';
          bubble.setAttribute('data-question', i);
          bubble.setAttribute('data-choice', choice);
          bubble.title = `Question ${i} - Choice ${choice}`;
          
          // Check if this choice is already selected
          if (currentAnswerKey[i] === choice) {
            bubble.classList.add('selected');
          }
          
          bubble.addEventListener('click', (e) => {
            handleAnswerKeyBubbleClick(e, i, choice);
          });
          
          choicesContainer.appendChild(bubble);
        });
        
        keyItem.appendChild(questionNumber);
        keyItem.appendChild(choicesContainer);
        answerKeyGrid.appendChild(keyItem);
      }
      
      document.getElementById('answerKeySection').style.display = 'block';
    }

    function handleAnswerKeyBubbleClick(event, questionNumber, choice) {
      const bubble = event.target;
      const allBubblesForQuestion = document.querySelectorAll(`[data-question="${questionNumber}"].key-bubble`);
      
      // If this bubble is already selected, unselect it
      if (bubble.classList.contains('selected')) {
        bubble.classList.remove('selected');
        delete currentAnswerKey[questionNumber];
      } else {
        // Unselect all other bubbles for this question
        allBubblesForQuestion.forEach(b => b.classList.remove('selected'));
        
        // Select this bubble
        bubble.classList.add('selected');
        currentAnswerKey[questionNumber] = choice;
      }
      
      console.log('Current Answer Key:', currentAnswerKey);
    }

    // Save answer key
    document.getElementById('saveAnswerKey').addEventListener('click', () => {
      if (Object.keys(currentAnswerKey).length === 0) {
        alert('Please set at least one answer first.');
        return;
      }
      
      alert(`Answer key saved with ${Object.keys(currentAnswerKey).length} answers!`);
      console.log('Saved Answer Key:', currentAnswerKey);
    });

    // Clear answer key
    document.getElementById('clearAnswerKey').addEventListener('click', () => {
      if (confirm('Are you sure you want to clear all answers?')) {
        currentAnswerKey = {};
        const allBubbles = document.querySelectorAll('.key-bubble.selected');
        allBubbles.forEach(bubble => {
          bubble.classList.remove('selected');
        });
        alert('Answer key cleared!');
      }
    });

    // Save template
    document.getElementById('saveTemplate').addEventListener('click', () => {
      if (Object.keys(currentAnswerKey).length === 0) {
        alert('Please generate an answer sheet and set at least one answer first.');
        return;
      }
      
      const templateData = {
        examTitle: document.getElementById('examTitle').value,
        subjectName: document.getElementById('subjectName').value,
        className: document.getElementById('className').value,
        totalQuestions: parseInt(document.getElementById('totalQuestions').value),
        studentIdLength: parseInt(document.getElementById('studentIdLength').value),
        subjectIdLength: parseInt(document.getElementById('subjectIdLength').value),
        choiceOptions: parseInt(document.getElementById('choiceOptions').value),
        answerKey: currentAnswerKey,
        createdAt: new Date().toISOString()
      };
      
      console.log('Template Data:', templateData);
      alert('Template saved successfully! Check console for details.');
    });

    // Print functionality
    document.getElementById('printSheet').addEventListener('click', () => {
      window.print();
    });

    // Validate input lengths
    document.getElementById('studentIdLength').addEventListener('change', (e) => {
      const value = parseInt(e.target.value);
      if (value < 1 || value > 15) {
        alert('Student ID length must be between 1 and 15 digits.');
        e.target.value = Math.max(1, Math.min(15, value || 8));
      }
    });

    document.getElementById('subjectIdLength').addEventListener('change', (e) => {
      const value = parseInt(e.target.value);
      if (value < 0 || value > 8) {
        alert('Subject ID length must be between 0 and 8 digits.');
        e.target.value = Math.max(0, Math.min(8, value || 0));
      }
    });

    console.log('Answer Sheet Maker Demo loaded successfully');
  </script>
</body>
</html>