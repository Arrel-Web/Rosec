<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.8">
  <title>Answer Sheet & Key Maker - Rosec</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="stylesheet" href="css/modern-sidebar.css">
  <link rel="stylesheet" href="css/user-profile.css">
  <link rel="stylesheet" href="css/enhanced-topbar.css">
  <link rel="stylesheet" href="css/enhanced-features.css">
  <link rel="stylesheet" href="css/mobile-enhancements.css">
  <style>
    .layout {
      display: flex;
    }
    
    .main-area {
      position: relative;
      padding: 0;
      margin-left: 240px; /* Sidebar width */
      min-height: 100vh;
      background: linear-gradient(180deg,#fafafa,#f1f3f4);
      width: 100%;
      box-sizing: border-box;
      transition: margin-left 0.3s ease;
      display: flex;
      flex-direction: column;
    }

    /* Content Layout - Two Column Design */
    .content-layout {
      display: grid;
      grid-template-columns: 420px 1fr;
      gap: 30px;
      align-items: start;
      padding: 25px 25px 25px 15px;
    }

    /* Enhanced Form Card Styling */
    .enhanced-form-card {
      background: linear-gradient(145deg, #ffffff, #f8f9ff);
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.12);
      padding: 0;
      border: 1px solid #e8eaed;
      position: sticky;
      top: 20px;
      overflow: visible;
      transition: all 0.3s ease;
    }

    /* Enhanced Form Header */
    .enhanced-form-header {
      padding: 20px;
      background: linear-gradient(135deg, #fafbfc, #f8f9ff);
      border-bottom: 1px solid #e8eaed;
      border-radius: 20px 20px 0 0;
    }

    .form-header-content {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
    }

    .form-icon {
      width: 45px;
      height: 45px;
      background: linear-gradient(135deg, #1a73e8, #4285f4);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 18px;
      box-shadow: 0 3px 12px rgba(26, 115, 232, 0.3);
      flex-shrink: 0;
    }

    .form-title-section .form-title {
      margin: 0 0 4px 0;
      color: #1a73e8;
      font-size: 22px;
      font-weight: 700;
    }

    .form-title-section .form-subtitle {
      margin: 0;
      color: #5f6368;
      font-size: 14px;
      line-height: 1.3;
    }

    /* Progress Bar */
    .form-progress {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .progress-bar {
      flex: 1;
      height: 8px;
      background: #e8eaed;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #1a73e8, #4285f4);
      border-radius: 4px;
      width: 25%;
      transition: width 0.5s ease;
      position: relative;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .progress-text {
      font-size: 14px;
      font-weight: 600;
      color: #1a73e8;
      white-space: nowrap;
    }

    /* Enhanced Form Content */
    .enhanced-form-content {
      padding: 30px;
    }

    /* Form Steps */
    .enhanced-form-step {
      display: none;
      animation: fadeInUp 0.5s ease;
      overflow: visible;
    }

    .enhanced-form-step.active {
      display: block;
      overflow: visible;
    }

    /* Force validation error visibility */
    .validation-error {
      display: flex !important;
      visibility: visible !important;
      opacity: 1 !important;
      position: relative !important;
      z-index: 9999 !important;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Step Header */
    .step-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e8eaed;
    }

    .step-number {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #1a73e8, #4285f4);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 18px;
      font-weight: 700;
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
      flex-shrink: 0;
    }

    .step-title {
      margin: 0 0 5px 0;
      color: #1a73e8;
      font-size: 20px;
      font-weight: 600;
    }

    .step-subtitle {
      margin: 0;
      color: #5f6368;
      font-size: 14px;
    }

    /* Enhanced Input Groups */
    .enhanced-input-group {
      margin-bottom: 20px;
    }

    .enhanced-input-group label {
      display: block;
      margin-bottom: 8px;
      color: #000000;
      font-weight: 600;
      font-size: 14px;
    }

    .enhanced-input-group .config-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e8eaed;
      border-radius: 12px;
      font-size: 14px;
      transition: all 0.3s ease;
      background: #fafbfc;
      box-sizing: border-box;
    }

    .enhanced-input-group .config-input:focus {
      outline: none;
      border-color: #1a73e8;
      background: white;
      box-shadow: 0 0 0 4px rgba(26, 115, 232, 0.1);
    }

    .input-hint {
      display: block;
      margin-top: 6px;
      color: #5f6368;
      font-size: 12px;
    }

    /* Step Navigation */
    .step-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #e8eaed;
    }

    .nav-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }


    /* Step navigation buttons - override enhanced-features.css */
    .step-navigation .nav-btn {
      background: linear-gradient(135deg, #1a73e8, #4285f4) !important;
      color: white !important;
      border: none !important;
      border-radius: 12px !important;
      padding: 12px 20px !important;
      font-size: 14px !important;
      font-weight: 600 !important;
      cursor: pointer !important;
      transition: all 0.3s ease !important;
      display: flex !important;
      align-items: center !important;
      gap: 8px !important;
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3) !important;
      white-space: nowrap !important;
      width: auto !important;
      height: auto !important;
    }

    .step-navigation .nav-btn:hover:not(:disabled) {
      background: linear-gradient(135deg, #1557b0, #3367d6) !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 6px 16px rgba(26, 115, 232, 0.4) !important;
    }

    .step-navigation .nav-btn:disabled {
      background: linear-gradient(135deg, #f1f3f4, #e8eaed) !important;
      color: #9aa0a6 !important;
      opacity: 0.6 !important;
      cursor: not-allowed !important;
      transform: none !important;
    }

    .step-navigation .nav-btn.nav-btn-secondary {
      background: linear-gradient(135deg, #f1f3f4, #e8eaed) !important;
      color: #5f6368 !important;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
    }

    .step-navigation .nav-btn.nav-btn-secondary:hover {
      background: linear-gradient(135deg, #e8eaed, #dadce0) !important;
      color: #1a73e8 !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
    }

    /* Validation Error (copied from academic periods) */
    .validation-error {
      background: linear-gradient(135deg, #fce4ec, #ffebee);
      border: 1px solid #f48fb1;
      border-radius: 8px;
      padding: 12px 16px;
      margin: 15px 0;
      color: #c2185b;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 10px;
      animation: shake 0.5s ease-in-out;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    /* Right Column - Preview Area */
    .preview-area {
      background: white;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.12);
      border: 1px solid #e8eaed;
      overflow: hidden;
    }

    .preview-header {
      padding: 20px 25px;
      background: linear-gradient(135deg, #f8f9ff, #e8f0fe);
      border-bottom: 1px solid #e8eaed;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .preview-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .preview-title-content h3 {
      margin: 0 0 4px 0;
      color: #1a73e8;
      font-size: 22px;
      font-weight: 700;
    }

    .preview-title-content p {
      margin: 0;
      color: #5f6368;
      font-size: 14px;
      line-height: 1.3;
    }

    .preview-content {
      padding: 25px;
      max-height: 70vh;
      overflow-y: auto;
    }

    /* Empty State */
    .empty-preview {
      text-align: center;
      padding: 60px 20px;
      color: #5f6368;
    }

    .empty-icon {
      font-size: 48px;
      color: #e8eaed;
      margin-bottom: 20px;
    }

    .empty-preview h4 {
      margin: 0 0 10px 0;
      color: #1a73e8;
      font-size: 18px;
    }

    .empty-preview p {
      margin: 0;
      font-size: 14px;
      line-height: 1.5;
    }

    /* Points Configuration Enhanced */
    .points-container {
      background: #f8f9ff;
      border-radius: 12px;
      padding: 20px;
      margin-top: 15px;
    }

    .points-row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 15px;
      padding: 15px;
      background: white;
      border-radius: 12px;
      border: 2px solid #e8eaed;
      transition: all 0.3s ease;
      flex-wrap: wrap;
      position: relative;
    }

    .points-row:hover {
      border-color: #1a73e8;
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.1);
    }

    .range-inputs {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .points-input-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .range-text, .points-text {
      color: #5f6368;
      font-weight: 500;
    }

    .small-input {
      width: 60px;
      padding: 8px 12px;
      border: 2px solid #e8eaed;
      border-radius: 8px;
      text-align: center;
      font-weight: 600;
    }

    .small-input:focus {
      outline: none;
      border-color: #1a73e8;
      box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
    }

    .remove-points-row {
      margin-left: auto;
      flex-shrink: 0;
      width: 32px;
      height: 32px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: bold;
      border-radius: 50%;
      background: #dc3545;
      color: white;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .remove-points-row:hover {
      background: #c82333;
      transform: scale(1.1);
    }

    .add-range-btn {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #e8f0fe, #f0f7ff);
      border: 2px dashed #1a73e8;
      border-radius: 12px;
      color: #1a73e8;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .add-range-btn:hover {
      background: linear-gradient(135deg, #1a73e8, #4285f4);
      color: white;
      border-style: solid;
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .content-layout {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .enhanced-form-card {
        position: relative;
        top: 0;
      }
    }

    @media (max-width: 768px) {
      .content-layout {
        padding: 15px;
      }
      
      .form-header-content {
        flex-direction: column;
        text-align: center;
        gap: 10px;
      }
      
      .step-header {
        flex-direction: column;
        text-align: center;
        gap: 10px;
      }
      
      .step-navigation {
        flex-direction: column;
        gap: 10px;
      }
      
      .step-navigation .nav-btn {
        width: 100%;
        justify-content: center;
      }
    }
    
    /* Topbar Navigation Icons */
    .topbar-nav-icons {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-right: 15px;
    }
    
    .topbar-nav-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: #6c757d;
      color: white;
      text-decoration: none;
      border-radius: 50%;
      font-size: 16px;
      transition: all 0.2s ease;
      border: none;
      cursor: pointer;
    }
    
    .topbar-nav-btn:hover {
      background: #5a6268;
      color: white;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .top-actions {
      display: flex;
      align-items: center;
    }
    
    .sheet-container {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .config-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .config-card {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }
    
    .points-config {
      margin-top: 15px;
    }
    
    .points-row {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 10px;
      padding: 12px;
      background: white;
      border-radius: 6px;
      border: 1px solid #e0e0e0;
      flex-wrap: wrap;
      position: relative;
    }
    
    .points-row label,
    .points-row span {
      font-size: 14px;
      color: #333;
      white-space: nowrap;
    }
    
    .points-row .input {
      flex-shrink: 0;
    }
    
    .points-row .remove-points-row {
      margin-left: auto;
      flex-shrink: 0;
      width: 32px;
      height: 32px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: bold;
      border-radius: 50%;
      background: #dc3545;
      color: white;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .points-row .remove-points-row:hover {
      background: #c82333;
      transform: scale(1.1);
    }
    
    .answer-sheet-preview {
      border: 2px solid #000;
      padding: 20px;
      background: white;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 20px;
      page-break-inside: avoid;
    }
    
    .scanner-marker {
      width: 20px;
      height: 20px;
      background: #000;
      display: inline-block;
      margin: 0 5px;
    }
    
    .sheet-header {
      text-align: center;
      border-bottom: 2px solid #000;
      padding-bottom: 15px;
      margin-bottom: 20px;
    }
    
    .student-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #000;
    }
    
    .id-sections {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 20px 0;
      padding: 15px 0;
      border-top: 1px solid #000;
      border-bottom: 1px solid #000;
    }
    
    .id-section {
      text-align: center;
    }
    
    .id-section h4 {
      margin-bottom: 10px;
      font-weight: bold;
    }
    
    .id-bubbles {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .digit-column {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    
    .digit-label {
      font-size: 10px;
      font-weight: bold;
      margin-bottom: 2px;
    }
    
    .questions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-left: 150px;
    }
    
    .question-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 8px;
      padding: 4px;
      border-radius: 4px;
      flex-wrap: wrap;
    }
    
    .question-number {
      min-width: 25px;
      font-weight: bold;
      flex-shrink: 0;
    }
    
    .question-choices {
      display: flex;
      align-items: center;
      gap: 4px;
      flex: 1;
    }
    
    .choice-bubble {
      width: 16px;
      height: 16px;
      border: 2px solid #000;
      border-radius: 50%;
      display: inline-block;
      margin: 0 3px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    
    .choice-bubble.filled {
      background: #000;
    }
    
    .choice-bubble:hover {
      background: #ccc;
    }
    
    .id-bubble {
      width: 14px;
      height: 14px;
      border: 1px solid #000;
      border-radius: 50%;
      display: block;
      margin: 1px auto;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    
    .id-bubble.filled {
      background: #000;
    }
    
    .id-bubble:hover {
      background: #ccc;
    }
    
    .points-display {
      font-size: 10px;
      color: #666;
      margin-left: 5px;
    }
    
    .answer-key-section {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid #000;
    }
    
    .key-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .key-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 8px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #f9f9f9;
    }
    
    .key-question-number {
      font-weight: bold;
      margin-bottom: 8px;
      color: #333;
    }
    
    .key-choices {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    
    .key-bubble {
      width: 20px;
      height: 20px;
      border: 2px solid #000;
      border-radius: 50%;
      display: inline-block;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }
    
    .key-bubble:hover {
      background: #e0e0e0;
      transform: scale(1.1);
    }
    
    .key-bubble.selected {
      background: #000;
    }
    
    .key-bubble::after {
      content: attr(data-choice);
      position: absolute;
      bottom: -18px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      font-weight: bold;
    }
    
    .btn-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
    }
    
    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .btn-primary { background: #1a73e8; color: white; }
    .btn-success { background: #28a745; color: white; }
    .btn-secondary { background: #6c757d; color: white; }
    .btn-warning { background: #ffc107; color: #000; }
    
    .form-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 15px;
    }
    
    .form-row label {
      font-weight: 600;
      color: #333;
    }
    
    .input {
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.2s ease;
    }
    
    .input:focus {
      outline: none;
      border-color: #1a73e8;
      box-shadow: 0 0 0 2px rgba(26,115,232,0.1);
    }
    
    .required-field {
      color: #dc3545;
      font-weight: bold;
    }

        
    @media print {
      /* Set page size to half of short bond paper (5.5" x 8.5") */
      @page {
        size: 5.5in 8.5in;
        margin: 0.25in;
      }
      
      /* Hide everything except the answer sheet */
      .sidebar,
      .topbar,
      .config-section,
      .btn-group,
      .topbar-nav-icons,
      .answer-key-section,
      .sidebar-toggle,
      .theme-toggle,
      .user-profile,
      .user-dropdown,
      .nav-item,
      .nav-section,
      .sidebar-header,
      .sidebar-nav,
      button,
      .sheet-container > *:not(#sheetPreview) {
        display: none !important;
      }
      
      /* Show only the answer sheet preview */
      .main-area {
        margin: 0 !important;
        padding: 0 !important;
        background: white !important;
        width: 100% !important;
        height: 100% !important;
      }
      
      .sheet-container {
        padding: 0 !important;
        margin: 0 !important;
        box-shadow: none !important;
        background: white !important;
        width: 100% !important;
        height: 100% !important;
      }
      
      .answer-sheet-preview {
        display: block !important;
        border: 2px solid #000 !important;
        margin: 0 !important;
        padding: 10px !important;
        background: white !important;
        font-size: 8px !important;
        font-family: 'Courier New', monospace !important;
        page-break-inside: avoid !important;
        width: 100% !important;
        height: auto !important;
        max-width: none !important;
        box-sizing: border-box !important;
        overflow: visible !important;
      }
      
      /* Ensure proper page layout */
      body {
        margin: 0 !important;
        padding: 0 !important;
        background: white !important;
        font-family: 'Courier New', monospace !important;
        font-size: 8px !important;
        width: 100% !important;
        height: 100% !important;
      }
      
      html {
        margin: 0 !important;
        padding: 0 !important;
        width: 100% !important;
        height: 100% !important;
      }
      
      /* Header section - keep exactly as generated */
      .sheet-header {
        margin-bottom: 6px !important;
        padding-bottom: 6px !important;
        border-bottom: 2px solid #000 !important;
        text-align: center !important;
      }
      
      .sheet-header h2 {
        font-size: 12px !important;
        margin: 0 !important;
        font-weight: bold !important;
      }
      
      .sheet-header p {
        font-size: 9px !important;
        margin: 2px 0 !important;
      }
      
      /* Student info section - keep exactly as generated */
      .student-info {
        display: grid !important;
        grid-template-columns: 1fr 1fr !important;
        gap: 10px !important;
        margin-bottom: 6px !important;
        padding-bottom: 6px !important;
        border-bottom: 1px solid #000 !important;
        font-size: 8px !important;
      }
      
      /* ID sections - keep exactly as generated */
      .id-sections {
        display: flex !important;
        justify-content: center !important;
        gap: 15px !important;
        margin: 6px 0 !important;
        padding: 6px 0 !important;
        border-top: 1px solid #000 !important;
        border-bottom: 1px solid #000 !important;
      }
      
      .id-section {
        text-align: center !important;
      }
      
      .id-section h4 {
        font-size: 8px !important;
        margin-bottom: 4px !important;
        font-weight: bold !important;
      }
      
      .id-bubbles {
        display: flex !important;
        justify-content: center !important;
        gap: 8px !important;
        flex-wrap: wrap !important;
      }
      
      .digit-column {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        gap: 1px !important;
      }
      
      .digit-label {
        font-size: 6px !important;
        font-weight: bold !important;
        margin-bottom: 1px !important;
      }
      
      .id-bubble {
        width: 8px !important;
        height: 8px !important;
        border: 1px solid #000 !important;
        border-radius: 50% !important;
        display: block !important;
        margin: 0.5px auto !important;
        font-size: 5px !important;
        line-height: 6px !important;
        text-align: center !important;
      }
      
      /* Questions section - keep exactly as generated */
      .questions-grid {
        margin-top: 4px !important;
        gap: 4px !important;
        display: flex !important;
        flex-direction: row !important;
        justify-content: space-between !important;
        align-items: flex-start !important;
        margin-left: 20px !important;
      }
      
      .question-column {
        break-inside: avoid !important;
        flex: 1 !important;
        margin-right: 6px !important;
      }
      
      .question-column:last-child {
        margin-right: 0 !important;
      }
      
      .question-row {
        margin-bottom: 2px !important;
        padding: 0.5px !important;
        display: flex !important;
        align-items: center !important;
        gap: 2px !important;
      }
      
      .question-number {
        min-width: 15px !important;
        font-size: 8px !important;
        font-weight: bold !important;
        flex-shrink: 0 !important;
      }
      
      .question-choices {
        display: flex !important;
        align-items: center !important;
        gap: 2px !important;
        flex: 1 !important;
      }
      
      .choice-bubble {
        width: 10px !important;
        height: 10px !important;
        border: 1px solid #000 !important;
        border-radius: 50% !important;
        display: inline-block !important;
        margin: 0 1px !important;
      }
      
      .question-choices span {
        font-size: 7px !important;
      }
      
      .points-display {
        font-size: 6px !important;
        color: #000 !important;
        margin-left: 3px !important;
      }
      
      /* Scanner markers - keep exactly as generated */
      .scanner-marker {
        background: #000 !important;
        width: 10px !important;
        height: 10px !important;
        margin: 0 2px !important;
        display: inline-block !important;
      }
      
      /* Footer - keep exactly as generated */
      .answer-sheet-preview > div:last-child {
        margin-top: 8px !important;
        text-align: center !important;
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
      }
      
      .answer-sheet-preview > div:last-child strong {
        font-size: 8px !important;
      }
      
      .answer-sheet-preview > div:last-child small {
        font-size: 6px !important;
      }
    }
    
    @media (max-width: 768px) {
      .config-section {
        grid-template-columns: 1fr;
      }
      
      .id-sections {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .student-info {
        grid-template-columns: 1fr;
      }
      
      .btn-group {
        flex-direction: column;
      }
      
      .topbar-nav-icons {
        gap: 10px;
        margin-right: 10px;
      }
      
      .topbar-nav-btn {
        width: 36px;
        height: 36px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- Sidebar -->
        <!-- Modern Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-brand">
          <div class="sidebar-logo">
            <i class="fa-solid fa-graduation-cap"></i>
          </div>
          <div>
            <div class="sidebar-title">Rosec</div>
          </div>
        </div>
        <button class="sidebar-toggle" id="sidebarToggle">
          <div class="hamburger-line"></div>
          <div class="hamburger-line"></div>
          <div class="hamburger-line"></div>
        </button>
      </div>
      
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Main</div>
        </div>
        
        <div class="nav-item">
          <a href="dashboard.html" class="nav-link" data-tooltip="Dashboard">
            <div class="nav-icon">
              <i class="fa-solid fa-house"></i>
            </div>
            <span class="nav-text">Dashboard</span>
          </a>
        </div>
        
        <div class="nav-item">
          <a href="analytics.html" class="nav-link" data-tooltip="Analytics">
            <div class="nav-icon">
              <i class="fa-solid fa-chart-line"></i>
            </div>
            <span class="nav-text">Analytics</span>
          </a>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Management</div>
        </div>
        
        <div class="nav-item">
          <a href="students.html" class="nav-link" data-tooltip="Students">
            <div class="nav-icon">
              <i class="fa-solid fa-user-graduate"></i>
            </div>
            <span class="nav-text">Students</span>
          </a>
        </div>
        
        <div class="nav-item">
          <a href="teachers.html" class="nav-link" id="teachers-nav" data-tooltip="Teachers">
            <div class="nav-icon">
              <i class="fa-solid fa-chalkboard-user"></i>
            </div>
            <span class="nav-text">Teachers</span>
          </a>
        </div>
        
        <div class="nav-item">
          <a href="classes.html" class="nav-link" data-tooltip="Classes">
            <div class="nav-icon">
              <i class="fa-solid fa-book"></i>
            </div>
            <span class="nav-text">Classes</span>
          </a>
        </div>
        
        <div class="nav-item">
          <a href="academic-periods.html" class="nav-link" id="academic-periods-nav" data-tooltip="Academic Periods">
            <div class="nav-icon">
              <i class="fa-solid fa-calendar-days"></i>
            </div>
            <span class="nav-text">Academic Periods</span>
          </a>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Tools</div>
        </div>
        
        <div class="nav-item">
          <a href="answer-sheet-maker.html" class="nav-link active" data-tooltip="Answer Sheet Maker">
            <div class="nav-icon">
              <i class="fa-solid fa-file-lines"></i>
            </div>
            <span class="nav-text">Answer Sheet Maker</span>
          </a>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">System</div>
        </div>
        
        <div class="nav-item">
          <a href="settings.html" class="nav-link" data-tooltip="Settings">
            <div class="nav-icon">
              <i class="fa-solid fa-gear"></i>
            </div>
            <span class="nav-text">Settings</span>
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main Area -->
    <div class="main-area">
      <header class="header">
        <div class="header-left">
          <div class="header-navigation">
            <button class="nav-btn" onclick="history.back()" title="Go Back">
              <i class="fa-solid fa-arrow-left"></i>
            </button>
            <button class="nav-btn" onclick="window.location.href='dashboard.html'" title="Dashboard">
              <i class="fa-solid fa-house"></i>
            </button>
          </div>
          <div class="header-title">
            <h1>Answer Sheet & Key Maker</h1>
            <p>Create answer sheets and answer keys</p>
          </div>
        </div>
        
        <div class="user-section">
          <div class="user-profile">
            <button id="userIconBtn" class="user-profile-btn">
              <div class="user-avatar">
                <i class="fa-solid fa-user"></i>
              </div>
              <div class="user-info">
                <span class="user-name" id="userNameDisplay">Loading...</span>
                <span class="user-role-badge" id="userRoleBadge">User</span>
              </div>
              <i class="fa-solid fa-chevron-down dropdown-arrow"></i>
            </button>
            <div id="userDropdown" class="user-dropdown">
              <div class="dropdown-header">
                <div class="dropdown-avatar">
                  <i class="fa-solid fa-user"></i>
                </div>
                <div class="dropdown-user-info">
                  <div class="dropdown-name" id="user-name">User Name</div>
                  <div class="dropdown-email" id="user-email">user@example.com</div>
                  <div class="dropdown-role" id="user-role">Role: Loading...</div>
                </div>
              </div>
              <div class="dropdown-divider"></div>
              <div class="dropdown-menu">
                <button class="dropdown-item" id="profileBtn">
                  <i class="fa-solid fa-user-circle"></i>
                  <span>Profile</span>
                </button>
                <button class="dropdown-item" id="settingsBtn">
                  <i class="fa-solid fa-cog"></i>
                  <span>Settings</span>
                </button>
                <div class="dropdown-divider"></div>
                <button class="dropdown-item danger" id="signOutBtn">
                  <i class="fa-solid fa-sign-out-alt"></i>
                  <span>Sign Out</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </header>

      </main>

      <!-- Main Content Layout -->
      <div class="content-layout">
            <!-- Left Column: Configuration Form -->
            <div class="enhanced-form-card">
              <!-- Enhanced Form Header -->
              <div class="enhanced-form-header">
                <div class="form-header-content">
                  <div class="form-icon">
                    <i class="fa-solid fa-file-lines"></i>
                  </div>
                  <div class="form-title-section">
                    <h3 class="form-title">Answer Sheet Maker</h3>
                    <p class="form-subtitle">Configure exam settings and generate sheets</p>
                  </div>
                </div>
                <div class="form-progress">
                  <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                  </div>
                  <span class="progress-text" id="progressText">Step 1 of 4</span>
                </div>
              </div>


              <!-- Form Content -->
              <div class="enhanced-form-content">
                <!-- Step 1: Basic Settings -->
                <div class="enhanced-form-step active" id="step1">
                  <div class="step-header">
                    <div class="step-number">1</div>
                    <div>
                      <h3 class="step-title">Basic Settings</h3>
                      <p class="step-subtitle">Set up your exam title and subject</p>
                    </div>
                  </div>
                  <div class="enhanced-input-group">
                    <label for="examTitle">Exam Title</label>
                    <input type="text" id="examTitle" class="config-input" value="Midterm Examination" placeholder="Enter exam title">
                  </div>
                  <div class="enhanced-input-group">
                    <label for="subjectSelect">Subject</label>
                    <select id="subjectSelect" class="config-input">
                      <option value="">Select Subject</option>
                    </select>
                  </div>
                  <div class="step-navigation">
                    <div></div>
                    <button type="button" class="nav-btn nav-btn-primary" onclick="nextStep()">Next <i class="fa-solid fa-arrow-right"></i></button>
                  </div>
                </div>

                <!-- Step 2: Student ID Configuration -->
                <div class="enhanced-form-step" id="step2">
                  <div class="step-header">
                    <div class="step-number">2</div>
                    <div>
                      <h3 class="step-title">Student ID Format</h3>
                      <p class="step-subtitle">Configure ID bubble settings</p>
                    </div>
                  </div>
                  <div class="enhanced-input-group">
                    <label for="studentIdLength">Student ID Length <span class="required-field">*</span></label>
                    <input type="number" id="studentIdLength" class="config-input" min="1" max="15" value="8" placeholder="8">
                    <small class="input-hint">Number of digits (1-15)</small>
                  </div>
                  <div class="enhanced-input-group">
                    <label for="subjectIdLength">Subject ID Length</label>
                    <input type="number" id="subjectIdLength" class="config-input" min="0" max="8" value="0" placeholder="0">
                    <small class="input-hint">Optional: 0 to disable</small>
                  </div>
                  <div class="step-navigation">
                    <button type="button" class="nav-btn nav-btn-secondary" onclick="prevStep()"><i class="fa-solid fa-arrow-left"></i> Previous</button>
                    <button type="button" class="nav-btn nav-btn-primary" onclick="nextStep()">Next <i class="fa-solid fa-arrow-right"></i></button>
                  </div>
                </div>

                <!-- Step 3: Question Settings -->
                <div class="enhanced-form-step" id="step3">
                  <div class="step-header">
                    <div class="step-number">3</div>
                    <div>
                      <h3 class="step-title">Question Settings</h3>
                      <p class="step-subtitle">Configure your exam questions</p>
                    </div>
                  </div>
                  <div class="enhanced-input-group">
                    <label for="totalQuestions">Number of Questions</label>
                    <input type="number" id="totalQuestions" class="config-input" min="1" max="100" value="30">
                    <small class="input-hint">Maximum 100 questions</small>
                  </div>
                  <div class="enhanced-input-group">
                    <label for="choiceOptions">Answer Choices</label>
                    <select id="choiceOptions" class="config-input">
                      <option value="3">A, B, C (3 choices)</option>
                      <option value="4" selected>A, B, C, D (4 choices)</option>
                      <option value="5">A, B, C, D, E (5 choices)</option>
                    </select>
                  </div>
                  <div class="enhanced-input-group">
                    <label for="questionsPerColumn">Questions per Column</label>
                    <input type="number" id="questionsPerColumn" class="config-input" min="5" max="50" value="15">
                    <small class="input-hint">Layout organization</small>
                  </div>
                  <div class="step-navigation">
                    <button type="button" class="nav-btn nav-btn-secondary" onclick="prevStep()"><i class="fa-solid fa-arrow-left"></i> Previous</button>
                    <button type="button" class="nav-btn nav-btn-primary" onclick="nextStep()">Next <i class="fa-solid fa-arrow-right"></i></button>
                  </div>
                </div>

                <!-- Step 4: Points Configuration -->
                <div class="enhanced-form-step" id="step4">
                  <div class="step-header">
                    <div class="step-number">4</div>
                    <div>
                      <h3 class="step-title">Points Configuration</h3>
                      <p class="step-subtitle">Set point values for question ranges</p>
                    </div>
                  </div>
                  <div id="pointsConfig" class="points-container">
                    <div class="points-row">
                      <label>Questions</label>
                      <div class="range-inputs">
                        <input type="number" class="range-start small-input" placeholder="1" min="1" value="1">
                        <span class="range-text">to</span>
                        <input type="number" class="range-end small-input" placeholder="30" min="1" value="30">
                      </div>
                      <span>=</span>
                      <div class="points-input-group">
                        <input type="number" class="points-value small-input" placeholder="1" min="0.5" step="0.5" value="1">
                        <span class="points-text">points</span>
                      </div>
                      <button type="button" class="remove-points-row small-btn" title="Remove">
                        <i class="fa-solid fa-times"></i>
                      </button>
                    </div>
                  </div>
                  <button type="button" id="addPointsRow" class="add-range-btn">
                    <i class="fa-solid fa-plus"></i> Add Range
                  </button>
                  <div class="step-navigation">
                    <button type="button" class="nav-btn nav-btn-secondary" onclick="prevStep()"><i class="fa-solid fa-arrow-left"></i> Previous</button>
                    <button type="button" class="nav-btn nav-btn-primary" id="generateSheet">
                      <i class="fa-solid fa-file-lines"></i> Generate Sheet
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Right Column: Preview Area -->
            <div class="preview-area">
              <div class="preview-header">
                <div class="preview-title">
                  <i class="fa-solid fa-eye"></i>
                  <div class="preview-title-content">
                    <h3>Live Preview</h3>
                    <p>Real-time view of your answer sheet configuration</p>
                  </div>
                </div>
                <div class="btn-group">
                  <button id="saveTemplate" class="btn btn-success" style="display: none;">
                    <i class="fa-solid fa-save"></i>
                    Save Template
                  </button>
                  <button id="printSheet" class="btn btn-secondary" style="display: none;">
                    <i class="fa-solid fa-print"></i>
                    Print
                  </button>
                  <button id="exportPDF" class="btn btn-warning" style="display: none;">
                    <i class="fa-solid fa-file-pdf"></i>
                    Export PDF
                  </button>
                </div>
              </div>
              <div class="preview-content">
                <!-- Answer Sheet Preview -->
                <div id="sheetPreview" class="answer-sheet-preview" style="display: none;">
                  <!-- Generated sheet will appear here -->
                </div>

                <!-- Answer Key Section -->
                <div id="answerKeySection" class="answer-key-section" style="display: none;">
                  <h3><i class="fa-solid fa-key"></i> Answer Key Configuration</h3>
                  <p>Click the bubbles to fill in the correct answers for each question:</p>
                  <div id="answerKeyGrid" class="key-grid">
                    <!-- Answer key inputs will be generated here -->
                  </div>
                  <div class="btn-group">
                    <button id="saveAnswerKey" class="btn btn-success">
                      <i class="fa-solid fa-save"></i>
                      Save Answer Key
                    </button>
                    <button id="clearAnswerKey" class="btn btn-secondary">
                      <i class="fa-solid fa-eraser"></i>
                      Clear All
                    </button>
                  </div>
                </div>

                <!-- Empty State -->
                <div id="emptyPreview" class="empty-preview">
                  <div class="empty-icon">
                    <i class="fa-solid fa-file-lines"></i>
                  </div>
                  <h4>Ready to Create</h4>
                  <p>Complete the configuration steps on the left to generate your answer sheet preview.</p>
                </div>
              </div>
            </div>
          </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Step Navigation Functions
    let currentStep = 1;
    const totalSteps = 4;

    function updateProgressBar() {
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      const percentage = (currentStep / totalSteps) * 100;
      
      progressFill.style.width = percentage + '%';
      progressText.textContent = `Step ${currentStep} of ${totalSteps}`;
    }

    function showStep(stepNumber) {
      // Hide all steps
      for (let i = 1; i <= totalSteps; i++) {
        const step = document.getElementById(`step${i}`);
        if (step) {
          step.classList.remove('active');
        }
      }
      
      // Show current step
      const currentStepElement = document.getElementById(`step${stepNumber}`);
      if (currentStepElement) {
        currentStepElement.classList.add('active');
      }
      
      currentStep = stepNumber;
      updateProgressBar();
    }

    function nextStep() {
      // Validate current step before proceeding
      if (currentStep === 1) {
        // Step 1: Basic Settings - validate subject selection
        const subjectSelect = document.getElementById('subjectSelect');
        const subjectId = subjectSelect?.value;
        if (!subjectId) {
          console.log('Subject not selected, showing validation error');
          showValidationError('Please select a subject to continue.');
          return;
        }
      }
      
      // Remove any existing validation errors
      const errorDiv = document.querySelector('.validation-error');
      if (errorDiv) {
        errorDiv.remove();
      }
      
      if (currentStep < totalSteps) {
        showStep(currentStep + 1);
      }
    }

    function showValidationError(message) {
      // Remove any existing validation errors first
      const existingError = document.querySelector('.validation-error');
      if (existingError) {
        existingError.remove();
      }
      
      // Create new validation message
      const errorDiv = document.createElement('div');
      errorDiv.className = 'validation-error';
      errorDiv.style.cssText = `
        background: linear-gradient(135deg, #fce4ec, #ffebee) !important;
        border: 1px solid #f48fb1 !important;
        border-radius: 8px !important;
        padding: 12px 16px !important;
        margin: 15px 0 !important;
        color: #c2185b !important;
        font-size: 14px !important;
        display: flex !important;
        align-items: center !important;
        gap: 10px !important;
        animation: shake 0.5s ease-in-out !important;
        z-index: 9999 !important;
        position: relative !important;
        width: 100% !important;
        box-sizing: border-box !important;
        visibility: visible !important;
        opacity: 1 !important;
      `;
      
      errorDiv.innerHTML = `
        <i class="fa-solid fa-exclamation-triangle"></i>
        <span>${message}</span>
      `;
      
      // Insert after the subject select form group specifically (second enhanced-input-group)
      const step1 = document.getElementById('step1');
      const subjectFormGroup = step1?.querySelectorAll('.enhanced-input-group')[1]; // Get the second form group (subject)
      
      if (subjectFormGroup) {
        subjectFormGroup.insertAdjacentElement('afterend', errorDiv);
        console.log('Validation error inserted after subject form group');
      } else {
        // Fallback: try to find by label content
        const allFormGroups = step1?.querySelectorAll('.enhanced-input-group');
        let subjectGroup = null;
        allFormGroups?.forEach(group => {
          const label = group.querySelector('label');
          if (label && label.textContent.includes('Subject')) {
            subjectGroup = group;
          }
        });
        
        if (subjectGroup) {
          subjectGroup.insertAdjacentElement('afterend', errorDiv);
          console.log('Validation error inserted after subject group (fallback)');
        } else {
          // Last fallback: insert at the beginning of step1
          if (step1) {
            step1.insertBefore(errorDiv, step1.firstChild);
            console.log('Validation error inserted at beginning of step1 (last fallback)');
          }
        }
      }
      
      // Remove error after 5 seconds (copied from academic periods)
      setTimeout(() => {
        if (errorDiv.parentNode) {
          errorDiv.remove();
        }
      }, 5000);
    }

    function prevStep() {
      if (currentStep > 1) {
        showStep(currentStep - 1);
      }
    }

    // Initialize progress bar on page load
    document.addEventListener('DOMContentLoaded', function() {
      updateProgressBar();
      
      // Show empty preview initially
      const emptyPreview = document.getElementById('emptyPreview');
      if (emptyPreview) {
        emptyPreview.style.display = 'block';
      }
    });

    // Apply immediate restrictions for teachers before page fully loads
    // This prevents the flash of restricted content
    (function() {
      // Check if user is likely a teacher (this is a quick check, full verification happens later)
      const userRole = localStorage.getItem('userRole');
      
      if (userRole === 'teacher') {
        // Apply immediate CSS restrictions
        const style = document.createElement('style');
        style.id = 'immediate-teacher-restrictions';
        style.textContent = `
          /* Hide teacher-restricted elements immediately */
          a[href*="teachers.html"],
          a[href*="academic-periods.html"] {
            display: none !important;
          }
        `;
        document.head.appendChild(style);
      }
    })();
  </script>
  <script src="js/mobile-menu.js"></script>
  <script src="js/user-profile.js"></script>
  <script type="module">
    // Import Firebase modules for user-profile.js to work properly
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
    import { 
      getFirestore, collection, getDocs, query, where
    } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';
    import { 
      getAuth, onAuthStateChanged, signOut 
    } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';

    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAznHzrOLmLvI98_0P649Tx5TZEwXaNNBs",
      authDomain: "rosec-57d1d.firebaseapp.com",
      projectId: "rosec-57d1d",
      storageBucket: "rosec-57d1d.appspot.com",
      messagingSenderId: "994663054798",
      appId: "1:994663054798:web:6214585d90b6fcc583bf9f",
      measurementId: "G-LM6RHY4WTZ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Make Firebase functions globally available for user-profile.js
    window.getAuth = getAuth;
    window.getFirestore = getFirestore;
    window.onAuthStateChanged = onAuthStateChanged;
    window.signOut = signOut;
    window.collection = collection;
    window.getDocs = getDocs;
    window.query = query;
    window.where = where;
  </script>
  <script type="module" src="js/sidebar-toggle.js"></script>
  <script type="module" src="js/theme-manager.js"></script>
  <script src="js/mobile-enhancements.js"></script>
  <script type="module" src="js/answer-sheet-maker.js"></script>
</body>
</html>